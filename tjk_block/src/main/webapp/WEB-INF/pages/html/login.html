<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>登录</title>
  <link rel="stylesheet" href="../../../less&css/login/login.css" type="text/css">
  <link rel="stylesheet" href="../../../less&css/login/animation.css" type="text/css">
  <script src="../../../resources/jQuery.min.js"></script>
</head>


<body >
  <div id="dig"></div>
  <div id="ball" >
    <div class="ball-body" >
      <div id="load" class="load">
        <div class="di" id="headText">
          <h2 id="h">Welcome</h2>
        </div>
        <div class="di" id="UserInp">
          <input id="user" type="text" placeholder="Uname" value="">
        </div>
        <div class="di" id="pswdInp">
          <input id="pswd" type="password" placeholder="Password" value="">
        </div>
        <div class="di" id="login">
          <button id="btn" onclick="log()">Login</button>
        </div>
        <div id="helpmain">
          <div class="did" onclick="opened()">
            <div id="what">?</div>
          </div>
        </div>
      </div>
      <div class="Create1" id="Crea">
        <div class="cdi">
          <h2 id="h">注册</h2>
        </div>
        <div class="cdi">
          <input type="text" placeholder="Uname" id="createuser" value="">
        </div>
        <div class="cdi">
          <input type="password" placeholder="password" id="createPswd" value="">
        </div>
        <div class="cdi">
          <input type="text" placeholder="E-mail" id="email" value="">
        </div>
        <div class="cdi1">
          <div>
            <input type="text" name="capt" id="capt" placeholder="Capt">  
          </div>
          <div id="Csell">
            <button id="C-btn" onclick="sell()">发送验证码</button>
          </div>
           
        </div>
        <div class="cdi1">
          <button id="D-btn" onclick="regist()">创建账号</button>
          <button id="D-btn" onclick="loadUser()">前往登录</button>
        </div>
      </div>
    </div>   
  </div>
</body>
<script>
  setTimeout(() => {
    var a = 0
    setInterval(() => {
      a++
      if (a === 1) {
        headText.className = 'di2';
        login.className = 'di1';
      } else if (a === 2) {
        UserInp.className = 'di3';
        pswdInp.className = 'di4';
        helpmain.className = "di1"
      } else if (a === 3) {
        clearInterval
      }
    }, 50)
  }, 1100);
  //背景随机图片
  $(function(){
    var imgarr = ['../img/01.jpg', '../img/02.jpg', '../img/03.jpg',
      '../img/04.jpg', '../img/05.jpg', '../img/06.jpg',
      '../img/07.jpg', '../img/08.jpg', '../img/09.jpg',
      '../img/10.jpg', '../img/11.jpg', '../img/12.jpg',
      '../img/13.jpg', '../img/14.jpg', '../img/15.jpg']      
    var Imgmath = Math.floor(Math.random() * imgarr.length)
    $("body").css("backgroundImage",`url(${imgarr[Imgmath]})`).css("backgroundSize","cover")
 })
  //打开与关闭帮助界面
  function opened() {
    document.getElementById('helpmain').innerHTML = '<div class="did1" id="help"></div>'
    help.innerHTML = `<span id="close" onclick="closed()"><svg t="1638708764138" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3216" width="16" height="16"><path d="M866.016 740.992q28.992 30.016 42.496 55.008T904 852.992q-4 6.016-11.008 14.496T878.496 884t-15.008 14.496T850.976 908q-24.992 15.008-59.008 8t-60.992-34.016l-236-236-128 128q-59.008 59.008-96 96.992-38.016 38.016-75.488 47.008t-66.496-16.992L100 872q-6.016-6.016-7.008-8Q81.984 849.984 80 835.488t2.496-28.512T96 779.968t20-24q8.992-8 32-30.016l54.016-56q32.992-32 73.504-72t84.512-84q-48-48-91.488-91.008t-78.016-76.992-56.512-55.488-27.008-26.496q-26.016-26.016-26.496-51.488t17.504-51.488q8-10.016 23.008-23.488T142.016 120q30.016-20 54.016-17.504t48 27.488l31.008 31.008q23.008 23.008 56.992 56t76.512 74.496 88.512 86.496q38.016-38.016 74.496-74.016t68-67.488 56.992-56.512 42.496-42.016q24-23.008 52-30.496t54.016 12.512q0.992 0.992 6.496 4.992t11.008 8.992 10.496 9.504 7.008 5.504q27.008 26.016 26.496 56.512t-26.496 56.512Q862.048 280 835.552 306.976t-59.008 59.008-68.512 68l-76 76q36.992 36 72.512 70.496t66.016 64.512T825.568 700t40.512 40.992z" p-id="3217" fill="#fafaf8"></path></svg></span> 
    <a class="lik" id="falselogin" href="">无法登陆</a>
    <a class="lik" id="forgetPswd" href="">忘记密码</a> 
    <a class="lik1" id="createUser" onclick="CreateUser()">注册账号</a>`
  }
  function closed(){
    document.getElementById('helpmain').innerHTML = `<div class="did" onclick="opened()">
            <div id="what">?</div>
          </div>`
  }
  //切换注册界面
  function CreateUser(){
    load.className='load1';
    Crea.className="Create";
    user.value='';
    pswd.value=''
  }
  function loadUser(){
    load.className="load";
    Crea.className="Create1"
    createuser.value='';
    createPswd.value='';
    email.value='';
    capt.value=''
  }
  //登陆数据交互判断
  function log(){
    if(user.value==='') {
      return alert('用户名不得为空')
    }else if(pswd.value===''){
      return alert('密码不得为空')
    }else{
      $.ajax({
        type: "POST",
        url: "/userlogin",
        data:{username:user.value,password:pswd.value},
        success:function(data){
          if(data=='-1'){
            return alert('用户名或密码输入错误！')
          }else {
            alert("登陆成功")
            window.local.href='/'
          }
        },
      })
    }
  }
  //验证码发送请求 &倒计时
  function sell(){
    var ema=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/ig;
    if(!ema.test(email.value)){
      return alert('该邮箱不正确')
    }else{
      $.ajax({
        type: "POST",
        url: "/sendmail",
        data:{username:email.value},
        success:function(data){
          window.captdata=data;
          if(data.trim()==='-1'){
            return alert('验证码发送失败，请重新请求')
          }else{
            return alert('验证码发送成功，请前往邮箱查看')
          }
        },
      })
    }

    var sellif =1;
    var Stime=30;
    var time =setInterval(()=>{
      Stime--;
      Csell.innerHTML=`<span class="wtime">${Stime}</span>`
      if(Stime==0){
      Csell.innerHTML='<button id="C-btn" onclick="sell()">发送验证码</button>'
      sellif=0;
        clearInterval(time)
      }
    },1000)
  }
//创建账号数据交互
function regist(){
  if(createPswd.value===''){
    return alert('密码不得为空');
  }else if(createuser.value===''){
    return alert('用户名不得为空');
  }else if(email.value===''){
    return alert('邮箱不得为空')
  }else if(capt.value!==window.captdata.trim()){
    return alert('验证码不正确')
  }else{
    $.ajax({
      type: "POST",
      url: "/useregist",
      data:{username:createuser.value,password:createPswd.value,email:email.value},
      success:function(data){
        if(data==='-1') {
          return alert('用户名已被创建')
        }else if(data==='-2'){
          return alert('该邮箱所创建的账户以超三个')
        }else{
          return alert('账号创建成功')
        }
      },
    })
  }
}

</script>

</html>